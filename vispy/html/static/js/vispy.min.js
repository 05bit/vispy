(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){function decode_base64(base64){var binary_string=window.atob(base64);var len=binary_string.length;var bytes=new Uint8Array(len);for(var i=0;i<len;i++){var ascii=binary_string.charCodeAt(i);bytes[i]=ascii}return bytes.buffer}var _typed_array_map={float32:Float32Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array};function to_array_buffer(data){var storage_type=data["storage_type"];if(storage_type==undefined){return data}var data_type=data["data_type"];var contents=data["buffer"];if(storage_type=="javascript_array"){return _typed_array_map[data_type](contents)}else if(storage_type=="javascript_typed_array"||storage_type=="array_buffer"){return contents}else if(storage_type=="binary"){return contents.buffer}else if(storage_type=="base64"){var array=decode_base64(contents);return array}}module.exports={to_array_buffer:to_array_buffer}},{}],2:[function(require,module,exports){var VispyCanvas=require("./vispycanvas.js");function get_pos(c,e){var rect=c.getBoundingClientRect();return[e.clientX-rect.left,e.clientY-rect.top]}function normalize_pos(c,pos){return[2*pos[0]/c.width-1,1-2*pos[1]/c.height]}function get_modifiers(e){var modifiers=[];if(e.altKey)modifiers.push("alt");if(e.ctrlKey)modifiers.push("ctrl");if(e.metaKey)modifiers.push("meta");if(e.shiftKey)modifiers.push("shift");return modifiers}function get_key_text(keynum){return String.fromCharCode(keynum).toUpperCase().trim()}function _get_keynum(e){if(window.event){return e.keyCode}else if(e.which){return e.which}}var _key_map={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CONTROL",18:"ALT",27:"ESCAPE",32:"SPACE",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",45:"INSERT",46:"DELETE",91:"META",92:"META",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"};function get_key_code(e){var keynum=_get_keynum(e);var key_code=_key_map[keynum];if(key_code==undefined){key_code=get_key_text(keynum)}return key_code}var _button_map={0:1,2:2,1:3};function gen_mouse_event(c,e,type){if(c._eventinfo.is_button_pressed)var button=_button_map[e.button];else button=null;var pos=get_pos(c.$el.get(0),e);var modifiers=get_modifiers(e);var press_event=c._eventinfo.press_event;var last_event=c._eventinfo.last_event;var event={type:type,pos:pos,button:button,is_dragging:press_event!=null,modifiers:modifiers,delta:null,press_event:press_event,last_event:null};return event}function gen_resize_event(c,size){var event={type:"resize",size:size};return event}function gen_paint_event(c){var event={type:"paint"};return event}function gen_initialize_event(c){var event={type:"initialize"};return event}function gen_key_event(c,e,type){var modifiers=get_modifiers(e);var last_event=c._eventinfo.last_event;var event={type:type,modifiers:modifiers,key_code:get_key_code(e),last_event:null};return event}VispyCanvas.prototype._mouse_press=function(e){};VispyCanvas.prototype._mouse_release=function(e){};VispyCanvas.prototype._mouse_move=function(e){};VispyCanvas.prototype._mouse_wheel=function(e){};VispyCanvas.prototype._mouse_click=function(e){};VispyCanvas.prototype._mouse_dblclick=function(e){};VispyCanvas.prototype._key_press=function(e){};VispyCanvas.prototype._key_release=function(e){};VispyCanvas.prototype._initialize=function(e){};VispyCanvas.prototype._resize=function(e){};VispyCanvas.prototype._paint=function(e){};VispyCanvas.prototype._event_tick=function(e){};VispyCanvas.prototype.on_mouse_press=function(f){this._mouse_press=f};VispyCanvas.prototype.on_mouse_release=function(f){this._mouse_release=f};VispyCanvas.prototype.on_mouse_move=function(f){this._mouse_move=f};VispyCanvas.prototype.on_mouse_wheel=function(f){this._mouse_wheel=f};VispyCanvas.prototype.on_mouse_dblclick=function(f){this._mouse_dblclick=f};VispyCanvas.prototype.on_key_press=function(f){this._key_press=f};VispyCanvas.prototype.on_key_release=function(f){this._key_release=f};VispyCanvas.prototype.on_initialize=function(f){this._initialize=f};VispyCanvas.prototype.on_resize=function(f){this._resize=f};VispyCanvas.prototype.on_paint=function(f){this._paint=f};VispyCanvas.prototype.on_event_tick=function(f){this._event_tick=f};VispyCanvas.prototype.initialize=function(){var event=gen_initialize_event(this);this._set_size();this._initialize(event)};VispyCanvas.prototype._set_size=function(size){if(size==undefined){size=[this.$el.width(),this.$el.height()]}this.size=size;this.width=size[0];this.height=size[1];return size};VispyCanvas.prototype.paint=function(){var event=gen_paint_event(this);this.event_queue.append(event)};VispyCanvas.prototype.update=VispyCanvas.prototype.paint;VispyCanvas.prototype.resize=function(size){size=this._set_size(size);var event=gen_resize_event(this,size);this.gl.canvas.width=size[0];this.gl.canvas.height=size[1];this.event_queue.append(event);this._resize(event)};VispyCanvas.prototype.event_tick=function(){this._event_tick();var ncommands=this.execute_pending_commands();if(ncommands>0){var event=gen_paint_event(this);this._paint(event)}};VispyCanvas.prototype.is_fullscreen=function(){return screenfull.enabled&screenfull.isFullscreen};VispyCanvas.prototype.toggle_fullscreen=function(){if(screenfull.enabled){if(screenfull.isFullscreen){screenfull.exit();this.resize(this._size)}else{this.$el.width("100%").height("100%");this._size=[this.$el.width(),this.$el.height()];screenfull.request(this.$el[0]);this.resize([screen.width,screen.height])}}};VispyCanvas.prototype.deactivate_context_menu=function(){document.oncontextmenu=function(){return false}};VispyCanvas.prototype.resizable=function(){var that=this;this.$el.resizable({resize:function(event,ui){that.resize([ui.size.width,ui.size.height])}})};function _events_can_be_combined(e1,e2){var type=e1.type;if(type==e2.type){if(type=="mouse_move"){if(e1.button==e2.button&e1.is_dragging==e2.is_dragging&e1.modifiers.equals(e2.modifiers)){return["pos"]}}else{}}return[]}function EventQueue(maxlen){if(maxlen==undefined){maxlen=100}this._queue=[];this.maxlen=maxlen}EventQueue.prototype.clear=function(){this._queue=[]};EventQueue.prototype.append=function(e,compress){var add_to_queue=true;if(compress==undefined){compress=true}if(compress){var last_event=this._queue[this._queue.length-1];if(last_event!=undefined){var props=_events_can_be_combined(e,last_event);if(props.length>0){for(var i=0;i<props.length;i++){var prop=props[i];this._queue[this._queue.length-1][prop]=e[prop]}add_to_queue=false}}}if(add_to_queue){this._queue.push(e)}if(this._queue.length>this.maxlen){this._queue.shift();this._queue[0].last_event=null}};EventQueue.prototype.get=function(){return this._queue};Object.defineProperty(EventQueue.prototype,"length",{get:function(){return this._queue.length}});function init_app(c){c.$el.resize(function(e){c.resize([e.width(),e.height()])});c.event_queue=new EventQueue;c._eventinfo={type:null,pos:null,button:null,is_dragging:null,key:null,modifiers:[],press_event:null,last_event:null,delta:null};c._eventinfo.is_button_pressed=0;c.$el.mousemove(function(e){var event=gen_mouse_event(c,e,"mouse_move");c._mouse_move(event);c.event_queue.append(event)});c.$el.mousedown(function(e){++c._eventinfo.is_button_pressed;var event=gen_mouse_event(c,e,"mouse_press");c._mouse_press(event);c._eventinfo.press_event=event;c.event_queue.append(event)});c.$el.mouseup(function(e){--c._eventinfo.is_button_pressed;var event=gen_mouse_event(c,e,"mouse_release");c._mouse_release(event);c._eventinfo.press_event=null;c.event_queue.append(event)});c.$el.click(function(e){c._eventinfo.press_event=null});c.$el.dblclick(function(e){c._eventinfo.press_event=null});if(c.$el.mousewheel!=undefined){c.$el.mousewheel(function(e){var event=gen_mouse_event(c,e,"mouse_wheel");event.delta=[e.deltaX*e.deltaFactor*.01,e.deltaY*e.deltaFactor*.01];c._mouse_wheel(event);c.event_queue.append(event);e.preventDefault();e.stopPropagation()})}c.$el.keydown(function(e){var event=gen_key_event(c,e,"key_press");c._key_press(event);c.event_queue.append(event)});c.$el.keyup(function(e){var event=gen_key_event(c,e,"key_release");c._key_release(event);c.event_queue.append(event)});c.$el.mouseout(function(e){})}var events=function(){};events.prototype.init=function(c){init_app(c)};module.exports=new events},{"./vispycanvas.js":9}],3:[function(require,module,exports){var VispyCanvas=require("./vispycanvas.js");var util=require("./util.js");var data=require("./data.js");var debug=util.debug;var to_array_buffer=data.to_array_buffer;function viewport(c){c.gl.viewport(0,0,c.width(),c.height())}function clear(c,color){c.gl.clearColor(color[0],color[1],color[2],color[3]);c.gl.clear(c.gl.COLOR_BUFFER_BIT)}function compile_shader(c,type,source){source=source.replace(/\\n/g,"\n");var shader=c.gl.createShader(c.gl[type]);c.gl.shaderSource(shader,source);c.gl.compileShader(shader);if(!c.gl.getShaderParameter(shader,c.gl.COMPILE_STATUS)){console.error(c.gl.getShaderInfoLog(shader));return null}return shader}function attach_shaders(c,program,vertex,fragment){c.gl.attachShader(program,vertex);c.gl.attachShader(program,fragment);c.gl.linkProgram(program);if(!c.gl.getProgramParameter(program,c.gl.LINK_STATUS)){console.warn("Could not initialise shaders on program '{0}'.".format(program))}}function create_attribute(c,program,name){var attribute_handle=c.gl.getAttribLocation(program,name);return attribute_handle}function activate_attribute(c,attribute_handle,vbo_id,type,stride,offset){var _attribute_info=get_attribute_info(type);var attribute_type=_attribute_info[0];var ndim=_attribute_info[1];_vbo_info=c._ns[vbo_id];var vbo_handle=_vbo_info.handle;c.gl.enableVertexAttribArray(attribute_handle);c.gl.bindBuffer(c.gl.ARRAY_BUFFER,vbo_handle);c.gl.vertexAttribPointer(attribute_handle,ndim,c.gl[attribute_type],false,stride,offset)}function deactivate_attribute(c,attribute_handle){c.gl.disableVertexAttribArray(attribute_handle)}function activate_texture(c,texture_handle,sampler_handle,texture_index){c.gl.activeTexture(c.gl.TEXTURE0+texture_index);c.gl.bindTexture(c.gl.TEXTURE_2D,texture_handle)}function set_texture_data(c,object_handle,gl_type,format,width,height,array){c.gl.bindTexture(gl_type,object_handle);c.gl.pixelStorei(c.gl.UNPACK_ALIGNMENT,1);var array_view=new Uint8Array(array);c.gl.texImage2D(gl_type,0,format,width,height,0,format,c.gl.UNSIGNED_BYTE,array_view)}function set_buffer_data(c,object_handle,gl_type,offset,array,reuse){c.gl.bindBuffer(gl_type,object_handle);if(!reuse){c.gl.bufferData(gl_type,array,c.gl.STATIC_DRAW)}else{c.gl.bufferSubData(gl_type,offset,array)}}function set_uniform(c,uniform_handle,uniform_function,value){array=to_array_buffer(value);if(uniform_function.indexOf("Matrix")>0){c.gl[uniform_function](uniform_handle,false,array)}else{c.gl[uniform_function](uniform_handle,array)}}var _attribute_type_map={"float":["FLOAT",1],vec2:["FLOAT",2],vec3:["FLOAT",3],vec4:["FLOAT",4],"int":["INT",1],ivec2:["INT",2],ivec3:["INT",3],ivec4:["INT",4]};function get_attribute_info(type){return _attribute_type_map[type]}var _uniform_type_map={"float":"uniform1fv",vec2:"uniform2fv",vec3:"uniform3fv",vec4:"uniform4fv","int":"uniform1iv",ivec2:"uniform2iv",ivec3:"uniform3iv",ivec4:"uniform4iv",mat2:"uniformMatrix2fv",mat3:"uniformMatrix3fv",mat4:"uniformMatrix4fv"};function get_uniform_function(type){return _uniform_type_map[type]}var _gl_type_map={VertexBuffer:"ARRAY_BUFFER",IndexBuffer:"ELEMENT_ARRAY_BUFFER",Texture2D:"TEXTURE_2D"};function get_gl_type(object_type){return _gl_type_map[object_type]}function parse_enum(c,str){var strs=str.split("|");var value=0;for(var i=0;i<strs.length;i++){var name=strs[i].toUpperCase().trim();value=value|c.gl[name]}return value}function GlirQueue(){this._queue=[]}GlirQueue.prototype.clear=function(){this._queue=[]};GlirQueue.prototype.append=function(e){this._queue.push(e)};GlirQueue.prototype.append_multi=function(es){for(var i=0;i<es.length;i++){this._queue.push(es[i])}};GlirQueue.prototype.get=function(){return this._queue};Object.defineProperty(GlirQueue.prototype,"length",{get:function(){return this._queue.length}});VispyCanvas.prototype.set_deferred=function(deferred){this._deferred=deferred};VispyCanvas.prototype.execute_pending_commands=function(){var q=this.glir_queue.get();if(q.length==0){return 0}for(var i=0;i<q.length;i++){this.command(q[i],false)}debug("Processed {0} events.".format(q.length));this.glir_queue.clear();return q.length};VispyCanvas.prototype.command=function(command,deferred){if(deferred==undefined){deferred=this._deferred}var method=command[0].toLowerCase();if(deferred){this.glir_queue.append(command)}else{this.glir[method](this,command.slice(1))}};var glir=function(){};glir.prototype.init=function(c){c._ns={};c._deferred=true;c.glir_queue=new GlirQueue;c.glir=this};glir.prototype.current=function(c,args){};glir.prototype.create=function(c,args){var id=args[0];var cls=args[1];if(cls=="VertexBuffer"){debug("Creating vertex buffer '{0}'.".format(id));c._ns[id]={object_type:cls,handle:c.gl.createBuffer(),size:0}}else if(cls=="IndexBuffer"){debug("Creating index buffer '{0}'.".format(id));c._ns[id]={object_type:cls,handle:c.gl.createBuffer(),size:0}}else if(cls=="Texture2D"){debug("Creating texture '{0}'.".format(id));c._ns[id]={object_type:cls,handle:c.gl.createTexture(),size:0,shape:[]}}else if(cls=="Program"){debug("Creating program '{0}'.".format(id));c._ns[id]={object_type:cls,handle:c.gl.createProgram(),attributes:{},uniforms:{},textures:{}}}};glir.prototype.delete=function(c,args){var id=args[0];var cls=c._ns[id].object_type;var handle=c._ns[id].handle;if(cls=="VertexBuffer"){debug("Deleting vertex buffer '{0}'.".format(id));c.gl.deleteBuffer(handle)}else if(cls=="IndexBuffer"){debug("Deleting index buffer '{0}'.".format(id));c.gl.deleteBuffer(handle)}else if(cls=="Texture2D"){debug("Deleting texture '{0}'.".format(id));c.gl.deleteTexture(handle)}else if(cls=="Program"){debug("Deleting program '{0}'.".format(id));c.gl.deleteProgram(handle)}};glir.prototype.shaders=function(c,args){var program_id=args[0];var vertex_code=args[1];var fragment_code=args[2];var handle=c._ns[program_id].handle;debug("Compiling shaders for program '{0}'.".format(program_id));var vs=compile_shader(c,"VERTEX_SHADER",vertex_code);var fs=compile_shader(c,"FRAGMENT_SHADER",fragment_code);debug("Attaching shaders for program '{0}'".format(program_id));attach_shaders(c,handle,vs,fs)};glir.prototype.size=function(c,args){var object_id=args[0];var size=args[1];var format=args[2];var object=c._ns[object_id];var object_handle=object.handle;var object_type=object.object_type;var gl_type=c.gl[get_gl_type(object_type)];if(object_type.indexOf("Texture")>=0){object.format=format.toUpperCase();debug("Setting texture size to {1} for '{0}'.".format(object_id,size))}else{debug("Setting buffer size to {1} for '{0}'.".format(object_id,size));set_buffer_data(c,object_handle,gl_type,0,size,false)}object.size=size};glir.prototype.data=function(c,args){var object_id=args[0];var offset=args[1];var data=args[2];var object=c._ns[object_id];var object_type=object.object_type;var object_handle=object.handle;var gl_type=c.gl[get_gl_type(object_type)];var array=to_array_buffer(data);if(object_type.indexOf("Texture")>=0){var shape=object.size;var height=shape[0];var width=shape[1];var format=c.gl[object.format];debug("Setting texture data for '{0}'.".format(object_id));set_texture_data(c,object_handle,gl_type,format,width,height,array);object.shape=shape}else{debug("Setting buffer data for '{0}'.".format(object_id));set_buffer_data(c,object_handle,gl_type,offset,array,object.size>0);object.size=array.byteLength}};glir.prototype.attribute=function(c,args){var program_id=args[0];var name=args[1];var type=args[2];var vbo_id=args[3][0];var stride=args[3][1];var offset=args[3][2];var program_handle=c._ns[program_id].handle;debug("Creating attribute '{0}' for program '{1}'.".format(name,program_id));var attribute_handle=create_attribute(c,program_handle,name);c._ns[program_id].attributes[name]={handle:attribute_handle,type:type,vbo_id:vbo_id,stride:stride,offset:offset}};glir.prototype.uniform=function(c,args){var program_id=args[0];var name=args[1];var type=args[2];var value=args[3];var program_handle=c._ns[program_id].handle;c.gl.useProgram(program_handle);if(c._ns[program_id].uniforms[name]==undefined){debug("Creating uniform '{0}' for program '{1}'.".format(name,program_id));var uniform_handle=c.gl.getUniformLocation(program_handle,name);var uniform_function=get_uniform_function(type);c._ns[program_id].uniforms[name]=[uniform_handle,uniform_function]}debug("Setting uniform '{0}' to '{1}' with {2} elements.".format(name,value,value.length));var uniform_info=c._ns[program_id].uniforms[name];var uniform_handle=uniform_info[0];var uniform_function=uniform_info[1];set_uniform(c,uniform_handle,uniform_function,value)};glir.prototype.texture=function(c,args){var program_id=args[0];var sampler_name=args[1];var texture_id=args[2];var texture_handle=c._ns[texture_id].handle;var program_handle=c._ns[program_id].handle;var texture_number=Object.keys(c._ns[program_id].textures).length;debug("Initializing texture '{0}' number {1} for program '{2}'.".format(texture_id,texture_number,program_id));var sampler_handle=c.gl.getUniformLocation(program_handle,sampler_name);c.gl.uniform1i(sampler_handle,texture_number);c._ns[program_id].textures[texture_id]={sampler_name:sampler_name,sampler_handle:sampler_handle,number:texture_number,handle:texture_handle}};glir.prototype.interpolation=function(c,args){var texture_id=args[0];var min=args[1].toUpperCase();var mag=args[2].toUpperCase();var texture_handle=c._ns[texture_id].handle;var gl_type=c.gl.TEXTURE_2D;c.gl.bindTexture(gl_type,texture_handle);c.gl.texParameteri(gl_type,c.gl.TEXTURE_MIN_FILTER,c.gl[min]);c.gl.texParameteri(gl_type,c.gl.TEXTURE_MAG_FILTER,c.gl[mag]);c.gl.bindTexture(gl_type,null)};glir.prototype.wrapping=function(c,args){var texture_id=args[0];var wrapping=args[1];var texture_handle=c._ns[texture_id].handle;var gl_type=c.gl.TEXTURE_2D;c.gl.bindTexture(gl_type,texture_handle);c.gl.texParameteri(gl_type,c.gl.TEXTURE_WRAP_S,c.gl[wrapping[0].toUpperCase()]);c.gl.texParameteri(gl_type,c.gl.TEXTURE_WRAP_T,c.gl[wrapping[1].toUpperCase()]);c.gl.bindTexture(gl_type,null)};glir.prototype.draw=function(c,args){var program_id=args[0];var mode=args[1].toUpperCase();var selection=args[2];var program_handle=c._ns[program_id].handle;var attributes=c._ns[program_id].attributes;var textures=c._ns[program_id].textures;for(attribute_name in attributes){var attribute=attributes[attribute_name];debug("Activating attribute '{0}' for program '{1}'.".format(attribute_name,program_id));activate_attribute(c,attribute.handle,attribute.vbo_id,attribute.type,attribute.stride,attribute.offset)}for(texture_id in textures){var texture=textures[texture_id];debug("Activating texture '{0}' for program '{1}'.".format(texture_id,program_id));activate_texture(c,texture.handle,texture.sampler_handle,texture.number)}c.gl.useProgram(program_handle);if(selection.length==2){var start=selection[0];var count=selection[1];debug("Rendering program '{0}' with {1}.".format(program_id,mode));c.gl.drawArrays(c.gl[mode],start,count)}else if(selection.length==3){var index_buffer_id=selection[0];var index_buffer_type=selection[1];var count=selection[2];var index_buffer_handle=c._ns[index_buffer_id].handle;debug("Rendering program '{0}' with {1} and index buffer '{2}'.".format(program_id,mode,index_buffer_id));c.gl.bindBuffer(c.gl.ELEMENT_ARRAY_BUFFER,index_buffer_handle);c.gl.drawElements(c.gl[mode],count,c.gl[index_buffer_type],0)}for(attribute_name in attributes){debug("Deactivating attribute '{0}' for program '{1}'.".format(attribute_name,program_id));deactivate_attribute(c,attributes[attribute_name].handle)}};glir.prototype.func=function(c,args){var name=args[0];debug("Calling {0}({1}).".format(name,args.slice(1)));for(var i=1;i<args.length;i++){if(typeof args[i]==="string"){args[i]=parse_enum(c,args[i])}}var func=c.gl[name];var func_args=args.slice(1);func.apply(c.gl,func_args)};module.exports=new glir},{"./data.js":1,"./util.js":7,"./vispycanvas.js":9}],4:[function(require,module,exports){var glir=require("./gloo.glir.js");function init_webgl(c){var canvas=c.$el.get(0);c.gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl")}var gloo=function(){this.glir=glir};gloo.prototype.init=function(c){init_webgl(c);this.glir.init(c)};module.exports=new gloo},{"./gloo.glir.js":3}],5:[function(require,module,exports){!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})},{}],6:[function(require,module,exports){!function(){"use strict";var a="undefined"!=typeof module&&module.exports,b="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,c=function(){for(var a,b,c=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],d=0,e=c.length,f={};e>d;d++)if(a=c[d],a&&a[1]in document){for(d=0,b=a.length;b>d;d++)f[c[0][d]]=a[d];return f}return!1}(),d={request:function(a){var d=c.requestFullscreen;a=a||document.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?a[d]():a[d](b&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[c.exitFullscreen]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(){},onerror:function(){},raw:c};return c?(Object.defineProperties(d,{isFullscreen:{get:function(){return!!document[c.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[c.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[c.fullscreenEnabled]}}}),document.addEventListener(c.fullscreenchange,function(a){d.onchange.call(d,a)}),document.addEventListener(c.fullscreenerror,function(a){d.onerror.call(d,a)}),void(a?module.exports=d:window.screenfull=d)):void(a?module.exports=!1:window.screenfull=!1)}()},{}],7:[function(require,module,exports){if(!String.prototype.format){String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})}}if(typeof String.prototype.trim==="undefined"){String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}}function is_array(x){return Object.prototype.toString.call(x)==="[object Array]"}Array.prototype.equals=function(array){if(!array)return false;if(this.length!=array.length)return false;for(var i=0,l=this.length;i<l;i++){if(this[i]instanceof Array&&array[i]instanceof Array){if(!this[i].equals(array[i]))return false}else if(this[i]!=array[i]){return false}}return true};if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(str){return this.slice(0,str.length)==str}}window.VISPY_DEBUG=false;function debug(msg){if(window.VISPY_DEBUG){console.debug(msg)}}module.exports={debug:debug}},{}],8:[function(require,module,exports){(function(global){var screenful=require("./lib/screenfull.min.js");var jquerymousewheel=require("./lib/jquery.mousewheel.min.js");var VispyCanvas=require("./vispycanvas.js");var gloo=require("./gloo.js");var events=require("./events.js");var util=require("./util.js");var data=require("./data.js");var Vispy=function(){this.events=events;this.gloo=gloo;this._is_loop_running=false;this._canvases=[]};Vispy.prototype.init=function(canvas_id){var canvas_el;if(typeof canvas_id==="string"){canvas_el=$(canvas_id)}else{canvas_el=canvas_id}var canvas=new VispyCanvas(canvas_el);canvas.deactivate_context_menu();this.events.init(canvas);this.gloo.init(canvas);this.register(canvas);return canvas};Vispy.prototype.register=function(canvas){this._canvases.push(canvas);console.log("Register",canvas)};Vispy.prototype.unregister=function(canvas){var index=this._canvases.indexOf(canvas);if(index>-1){this._canvases.splice(index,1)}console.log("Unregister",canvas)};Vispy.prototype.start_event_loop=function(){if(this._is_loop_running)return;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(c){window.setTimeout(c,1e3/60)}}();var that=this;(function animloop(){that._request_id=requestAnimFrame(animloop);try{for(var i=0;i<that._canvases.length;i++){that._canvases[i].event_tick()}}catch(err){that.stop_event_loop();throw err}})();this._is_loop_running=true;console.debug("Event loop started.")};Vispy.prototype.stop_event_loop=function(){window.cancelAnimationFrame(this._request_id);this._is_loop_running=false;console.debug("Event loop stopped.")};global.vispy=new Vispy}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./data.js":1,"./events.js":2,"./gloo.js":4,"./lib/jquery.mousewheel.min.js":5,"./lib/screenfull.min.js":6,"./util.js":7,"./vispycanvas.js":9}],9:[function(require,module,exports){var VispyCanvas=function($el){this.$el=$el};module.exports=VispyCanvas},{}]},{},[8]);